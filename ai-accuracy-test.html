<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOTO Routes - AI Accuracy Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #111418; color: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    </style>
</head>
<body>
    <div class="min-h-screen p-8">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold mb-2">ü§ñ AI Accuracy Test</h1>
                <p class="text-gray-400">Test the AI parsing accuracy with different job text examples</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Test Examples -->
                <div class="bg-gray-900 rounded-lg p-6 border border-gray-700">
                    <h2 class="text-2xl font-semibold mb-4 text-blue-400">Test Examples</h2>
                    <div class="space-y-4">
                        <button onclick="testExample('excellent')" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            ‚úÖ Excellent Example
                        </button>
                        <button onclick="testExample('good')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            üëç Good Example
                        </button>
                        <button onclick="testExample('fair')" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            ‚ö†Ô∏è Fair Example
                        </button>
                        <button onclick="testExample('poor')" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            ‚ùå Poor Example
                        </button>
                    </div>
                </div>

                <!-- Results Display -->
                <div class="bg-gray-900 rounded-lg p-6 border border-gray-700">
                    <h2 class="text-2xl font-semibold mb-4 text-green-400">Results</h2>
                    <div id="results" class="bg-gray-800 p-4 rounded-lg min-h-[300px] overflow-auto">
                        <div class="text-gray-400 italic">Click a test example to see AI accuracy results...</div>
                    </div>
                </div>
            </div>

            <!-- Test Examples Data -->
            <div class="mt-8 bg-gray-900 rounded-lg p-6 border border-gray-700">
                <h2 class="text-2xl font-semibold mb-4 text-purple-400">Example Job Texts</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-gray-800 p-4 rounded">
                        <h3 class="text-green-400 font-semibold mb-2">‚úÖ Excellent</h3>
                        <p class="text-sm text-gray-300">"Collect from 123 Main Street, B775JA, Birmingham. Deliver to 456 High Street, M1 4AN, Manchester. Price: ¬£150. Contact: John Smith 07700 900001"</p>
                    </div>
                    <div class="bg-gray-800 p-4 rounded">
                        <h3 class="text-blue-400 font-semibold mb-2">üëç Good</h3>
                        <p class="text-sm text-gray-300">"Pickup: B797RU, Tamworth. Dropoff: LS1 4DY, Leeds. ¬£200. Call 07700 900002"</p>
                    </div>
                    <div class="bg-gray-800 p-4 rounded">
                        <h3 class="text-yellow-400 font-semibold mb-2">‚ö†Ô∏è Fair</h3>
                        <p class="text-sm text-gray-300">"From somewhere in Birmingham to Manchester. Price around ¬£100-120. Urgent delivery needed."</p>
                    </div>
                    <div class="bg-gray-800 p-4 rounded">
                        <h3 class="text-red-400 font-semibold mb-2">‚ùå Poor</h3>
                        <p class="text-sm text-gray-300">"Need delivery. Somewhere to somewhere else. Call me."</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test examples data
        const testExamples = {
            excellent: {
                text: "Collect from 123 Main Street, B775JA, Birmingham. Deliver to 456 High Street, M1 4AN, Manchester. Price: ¬£150. Contact: John Smith 07700 900001",
                expected: "Excellent parsing with all fields clearly defined"
            },
            good: {
                text: "Pickup: B797RU, Tamworth. Dropoff: LS1 4DY, Leeds. ¬£200. Call 07700 900002",
                expected: "Good parsing with most fields identified"
            },
            fair: {
                text: "From somewhere in Birmingham to Manchester. Price around ¬£100-120. Urgent delivery needed.",
                expected: "Fair parsing with some uncertainty in addresses"
            },
            poor: {
                text: "Need delivery. Somewhere to somewhere else. Call me.",
                expected: "Poor parsing with minimal information available"
            }
        };

        // Simulate AI parsing with confidence scores
        function simulateAIParsing(jobText, quality) {
            const baseScores = {
                excellent: { collection_address: 95, delivery_address: 90, price: 85, postcode_collection: 80, postcode_delivery: 85, vehicle_details: 70, contact_info: 60, notes: 90 },
                good: { collection_address: 80, delivery_address: 75, price: 90, postcode_collection: 85, postcode_delivery: 80, vehicle_details: 50, contact_info: 70, notes: 85 },
                fair: { collection_address: 60, delivery_address: 55, price: 70, postcode_collection: 0, postcode_delivery: 0, vehicle_details: 30, contact_info: 40, notes: 80 },
                poor: { collection_address: 20, delivery_address: 15, price: 30, postcode_collection: 0, postcode_delivery: 0, vehicle_details: 0, contact_info: 10, notes: 60 }
            };

            const scores = baseScores[quality] || baseScores.poor;
            const confidenceValues = Object.values(scores);
            const overallConfidence = Math.round(confidenceValues.reduce((a, b) => a + b, 0) / confidenceValues.length);

            return {
                collection_address: quality === 'excellent' ? '123 Main Street, B775JA, Birmingham' : quality === 'good' ? 'B797RU, Tamworth' : quality === 'fair' ? 'Somewhere in Birmingham' : '',
                delivery_address: quality === 'excellent' ? '456 High Street, M1 4AN, Manchester' : quality === 'good' ? 'LS1 4DY, Leeds' : quality === 'fair' ? 'Manchester' : '',
                price: quality === 'excellent' ? 150 : quality === 'good' ? 200 : quality === 'fair' ? 110 : 0,
                postcode_collection: quality === 'excellent' ? 'B775JA' : quality === 'good' ? 'B797RU' : '',
                postcode_delivery: quality === 'excellent' ? 'M1 4AN' : quality === 'good' ? 'LS1 4DY' : '',
                vehicle_details: quality === 'excellent' ? 'Standard van' : '',
                contact_info: quality === 'excellent' ? 'John Smith 07700 900001' : quality === 'good' ? '07700 900002' : '',
                notes: quality === 'excellent' ? 'Standard delivery' : quality === 'good' ? 'Standard delivery' : quality === 'fair' ? 'Urgent delivery needed' : 'Minimal information',
                confidence_scores: scores,
                overall_confidence: overallConfidence,
                parsing_quality: quality,
                missing_fields: quality === 'fair' ? ['postcode_collection', 'postcode_delivery', 'vehicle_details'] : quality === 'poor' ? ['collection_address', 'delivery_address', 'postcode_collection', 'postcode_delivery', 'vehicle_details', 'contact_info'] : [],
                uncertain_fields: quality === 'fair' ? ['collection_address', 'delivery_address', 'price'] : quality === 'poor' ? ['price'] : []
            };
        }

        function testExample(quality) {
            const example = testExamples[quality];
            const result = simulateAIParsing(example.text, quality);
            
            const resultsDiv = document.getElementById('results');
            
            // Calculate accuracy rating
            let accuracyRating = 'poor';
            if (result.overall_confidence >= 85) accuracyRating = 'excellent';
            else if (result.overall_confidence >= 70) accuracyRating = 'good';
            else if (result.overall_confidence >= 50) accuracyRating = 'fair';
            
            let accuracyColor = 'text-red-400';
            let accuracyIcon = '‚ùå';
            
            switch (accuracyRating) {
                case 'excellent':
                    accuracyColor = 'text-green-400';
                    accuracyIcon = '‚úÖ';
                    break;
                case 'good':
                    accuracyColor = 'text-blue-400';
                    accuracyIcon = 'üëç';
                    break;
                case 'fair':
                    accuracyColor = 'text-yellow-400';
                    accuracyIcon = '‚ö†Ô∏è';
                    break;
            }
            
            resultsDiv.innerHTML = `
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2">Input Text:</h3>
                    <div class="bg-gray-700 p-3 rounded text-sm">"${example.text}"</div>
                </div>
                
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2">AI Accuracy Rating:</h3>
                    <div class="flex items-center gap-2">
                        <span class="${accuracyColor} font-bold text-xl">${accuracyIcon} ${accuracyRating.toUpperCase()}</span>
                        <span class="text-gray-400">(${result.overall_confidence}% confidence)</span>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2">Parsed Data:</h3>
                    <div class="bg-gray-700 p-3 rounded text-sm space-y-1">
                        <div><strong>Collection:</strong> ${result.collection_address || 'Not found'}</div>
                        <div><strong>Delivery:</strong> ${result.delivery_address || 'Not found'}</div>
                        <div><strong>Price:</strong> ¬£${result.price}</div>
                        <div><strong>Postcodes:</strong> ${result.postcode_collection || 'N/A'} ‚Üí ${result.postcode_delivery || 'N/A'}</div>
                        <div><strong>Contact:</strong> ${result.contact_info || 'Not found'}</div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2">Field Confidence Scores:</h3>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        ${Object.entries(result.confidence_scores).map(([field, score]) => {
                            let color = 'text-gray-400';
                            if (score >= 80) color = 'text-green-400';
                            else if (score >= 60) color = 'text-yellow-400';
                            else if (score > 0) color = 'text-red-400';
                            
                            return `<div class="flex justify-between"><span>${field.replace('_', ' ')}:</span><span class="${color}">${score}%</span></div>`;
                        }).join('')}
                    </div>
                </div>
                
                ${result.missing_fields.length > 0 ? `
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2 text-red-400">‚ö†Ô∏è Missing Fields:</h3>
                    <div class="text-red-400 text-sm">${result.missing_fields.join(', ')}</div>
                </div>
                ` : ''}
                
                ${result.uncertain_fields.length > 0 ? `
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2 text-yellow-400">‚ö†Ô∏è Uncertain Fields:</h3>
                    <div class="text-yellow-400 text-sm">${result.uncertain_fields.join(', ')}</div>
                </div>
                ` : ''}
                
                <div class="mt-4 p-3 bg-gray-700 rounded">
                    <div class="text-sm text-gray-300"><strong>Expected:</strong> ${example.expected}</div>
                </div>
            `;
        }
    </script>
</body>
</html>
