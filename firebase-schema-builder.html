<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Schema Builder - SOTO Routes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000000; color: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    </style>
</head>
<body>
    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-6xl">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold mb-2">üèóÔ∏è Firebase Schema Builder</h1>
                <p class="text-gray-400">Auto-create your SOTO Routes database schema</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Schema Creation -->
                <div class="bg-gray-900 rounded-lg p-6 border border-gray-700">
                    <h2 class="text-2xl font-semibold mb-4 text-green-400">Create Schema</h2>
                    <p class="text-gray-300 mb-4">This will automatically create all collections and sample data for your SOTO Routes system.</p>
                    
                    <div class="space-y-4">
                        <button onclick="createClientSchema()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            Create Client Management Schema
                        </button>
                        <button onclick="createRoutesSchema()" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            Create Routes & Jobs Schema
                        </button>
                        <button onclick="createJobsOnlySchema()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            Create Jobs Collection Only
                        </button>
                        <button onclick="createBookingsSchema()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            Create Bookings Schema
                        </button>
                        <button onclick="createTestSchema()" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            Create Test Schema
                        </button>
                        <button onclick="createDriversSchema()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            Create Drivers Schema
                        </button>
                        <button onclick="createAllSchemas()" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            Create ALL Schemas
                        </button>
                    </div>
                </div>

                <!-- Schema Viewer -->
                <div class="bg-gray-900 rounded-lg p-6 border border-gray-700">
                    <h2 class="text-2xl font-semibold mb-4 text-blue-400">View Schema</h2>
                    <p class="text-gray-300 mb-4">Check what's been created in your database.</p>
                    
                    <div class="space-y-4">
                        <button onclick="viewAllCollections()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            View All Collections
                        </button>
                        <button onclick="viewClients()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            View Clients
                        </button>
                        <button onclick="viewRoutes()" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            View Routes
                        </button>
                        <button onclick="viewBookings()" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            View Bookings
                        </button>
                        <button onclick="viewTestMessages()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            View Test Messages
                        </button>
                        <button onclick="viewDrivers()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            View Drivers
                        </button>
                        <button onclick="viewDriverAvailability()" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            View Driver Availability
                        </button>
                    </div>
                </div>
            </div>

            <!-- Results Display -->
            <div class="mt-8 bg-gray-900 rounded-lg p-6 border border-gray-700">
                <h2 class="text-2xl font-semibold mb-4 text-yellow-400">Results</h2>
                <div id="results" class="bg-gray-800 p-4 rounded-lg min-h-[200px] overflow-auto">
                    <div class="text-gray-400 italic">Results will appear here...</div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCkXzYFC1jQcA6yw6qY1Ao31uEYU4Rd0yA",
            authDomain: "soto-routes.firebaseapp.com",
            projectId: "soto-routes",
            storageBucket: "soto-routes.firebasestorage.app",
            messagingSenderId: "440989695549",
            appId: "1:440989695549:web:0bce8b92a46f7f79953454",
            measurementId: "G-4E3G40QQ9L"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Helper function to display results
        function displayResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const timestamp = new Date().toLocaleString();
            const colorClass = type === 'success' ? 'text-green-400' : type === 'error' ? 'text-red-400' : 'text-blue-400';
            
            resultsDiv.innerHTML += `
                <div class="mb-2 p-2 bg-gray-700 rounded">
                    <div class="text-xs text-gray-400">${timestamp}</div>
                    <div class="${colorClass}">${message}</div>
                </div>
            `;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        // Clear results
        function clearResults() {
            document.getElementById('results').innerHTML = '<div class="text-gray-400 italic">Results will appear here...</div>';
        }
        
        // Create Client Management Schema
        async function createClientSchema() {
            try {
                displayResult('Creating client management schema...', 'info');
                
                // Create sample clients
                const clients = [
                    {
                        clientCode: '1001',
                        companyName: 'EC Logistics',
                        pricingFormula: 'distance * 10',
                        contactEmail: 'contact@eclogistics.com',
                        isActive: true,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    },
                    {
                        clientCode: '1002',
                        companyName: 'SOTO Transport',
                        pricingFormula: 'distance * 8 + 50',
                        contactEmail: 'info@sototransport.com',
                        isActive: true,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    },
                    {
                        clientCode: '1003',
                        companyName: 'Quick Delivery Co',
                        pricingFormula: 'distance * 12',
                        contactEmail: 'orders@quickdelivery.com',
                        isActive: false,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    }
                ];
                
                for (const client of clients) {
                    await addDoc(collection(db, 'clients'), client);
                }
                
                displayResult('‚úÖ Client management schema created successfully!', 'success');
                displayResult(`Created ${clients.length} sample clients`, 'info');
                
            } catch (error) {
                displayResult(`‚ùå Error creating client schema: ${error.message}`, 'error');
            }
        }
        
        // Create Routes & Jobs Schema
        async function createRoutesSchema() {
            try {
                displayResult('Creating routes and jobs schema...', 'info');
                
                // Create sample routes
                const routes = [
                    {
                        routeId: 'route_' + Date.now(),
                        userId: 'user_123',
                        routeName: 'B797RU, Tamworth, Staffordshire',
                        driverName: 'John Smith',
                        driverLocation: 'B775JA, Birmingham',
                        totalJobs: 3,
                        totalDistance: 45.2,
                        estimatedDuration: 120,
                        status: 'active',
                        createdAt: new Date(),
                        updatedAt: new Date()
                    }
                ];
                
                for (const route of routes) {
                    const routeRef = await addDoc(collection(db, 'routes'), route);
                    
                    // Create jobs for this route
                    const jobs = [
                        {
                            routeId: route.routeId,
                            jobNumber: 1,
                            collectionAddress: '123 Main Street, B797RU, Tamworth, Staffordshire',
                            deliveryAddress: '456 High Street, M1 4AN, Manchester',
                            collectionPostcode: 'B797RU',
                            deliveryPostcode: 'M1 4AN',
                            price: 150.00,
                            distance: 15.2,
                            duration: 45,
                            notes: 'Fragile items - handle with care',
                            isCompleted: false,
                            createdAt: new Date()
                        },
                        {
                            routeId: route.routeId,
                            jobNumber: 2,
                            collectionAddress: '789 Park Road, B775JA, Birmingham',
                            deliveryAddress: '321 Queen Street, LS1 4DY, Leeds',
                            collectionPostcode: 'B775JA',
                            deliveryPostcode: 'LS1 4DY',
                            price: 200.00,
                            distance: 20.0,
                            duration: 60,
                            notes: 'Heavy items - use appropriate vehicle',
                            isCompleted: false,
                            createdAt: new Date()
                        },
                        {
                            routeId: route.routeId,
                            jobNumber: 3,
                            collectionAddress: '555 Industrial Estate, B797RU, Tamworth',
                            deliveryAddress: '999 Business Park, SW1A 0AA, London',
                            collectionPostcode: 'B797RU',
                            deliveryPostcode: 'SW1A 0AA',
                            price: 300.00,
                            distance: 10.0,
                            duration: 15,
                            notes: 'Urgent delivery - priority handling',
                            isCompleted: true,
                            createdAt: new Date()
                        }
                    ];
                    
                    for (const job of jobs) {
                        await addDoc(collection(db, 'jobs'), job);
                    }
                }
                
                displayResult('‚úÖ Routes and jobs schema created successfully!', 'success');
                displayResult(`Created ${routes.length} route(s) with jobs`, 'info');
                
            } catch (error) {
                displayResult(`‚ùå Error creating routes schema: ${error.message}`, 'error');
            }
        }
        
        // Create Jobs Collection Only
        async function createJobsOnlySchema() {
            try {
                displayResult('Creating jobs collection only...', 'info');
                
                // Create sample jobs without routes
                const jobs = [
                    {
                        routeId: null,
                        jobNumber: 1,
                        rawText: 'Collect from 123 Main Street, B797RU, Tamworth, Staffordshire and deliver to 456 High Street, M1 4AN, Manchester',
                        parsedData: {
                            collection_address: '123 Main Street, B797RU, Tamworth, Staffordshire',
                            delivery_address: '456 High Street, M1 4AN, Manchester',
                            collection_postcode: 'B797RU',
                            delivery_postcode: 'M1 4AN',
                            price: 150.00,
                            distance: 15.2,
                            duration: 45,
                            notes: 'Fragile items - handle with care'
                        },
                        status: 'parsed',
                        createdAt: new Date(),
                        assignedRouteId: null
                    },
                    {
                        routeId: null,
                        jobNumber: 2,
                        rawText: 'Pickup from 789 Park Road, B775JA, Birmingham and drop off at 321 Queen Street, LS1 4DY, Leeds',
                        parsedData: {
                            collection_address: '789 Park Road, B775JA, Birmingham',
                            delivery_address: '321 Queen Street, LS1 4DY, Leeds',
                            collection_postcode: 'B775JA',
                            delivery_postcode: 'LS1 4DY',
                            price: 200.00,
                            distance: 20.0,
                            duration: 60,
                            notes: 'Heavy items - use appropriate vehicle'
                        },
                        status: 'parsed',
                        createdAt: new Date(),
                        assignedRouteId: null
                    },
                    {
                        routeId: null,
                        jobNumber: 3,
                        rawText: 'Collect from 555 Industrial Estate, B797RU, Tamworth and deliver to 999 Business Park, SW1A 0AA, London',
                        parsedData: {
                            collection_address: '555 Industrial Estate, B797RU, Tamworth',
                            delivery_address: '999 Business Park, SW1A 0AA, London',
                            collection_postcode: 'B797RU',
                            delivery_postcode: 'SW1A 0AA',
                            price: 300.00,
                            distance: 10.0,
                            duration: 15,
                            notes: 'Urgent delivery - priority handling'
                        },
                        status: 'parsed',
                        createdAt: new Date(),
                        assignedRouteId: null
                    }
                ];
                
                for (const job of jobs) {
                    await addDoc(collection(db, 'jobs'), job);
                }
                
                displayResult('‚úÖ Jobs collection created successfully!', 'success');
                displayResult(`Created ${jobs.length} sample jobs`, 'info');
                displayResult('Jobs are ready for route assignment when you click "Save Routes"', 'info');
                
            } catch (error) {
                displayResult(`‚ùå Error creating jobs collection: ${error.message}`, 'error');
            }
        }
        
        // Create Bookings Schema
        async function createBookingsSchema() {
            try {
                displayResult('Creating bookings schema...', 'info');
                
                // Create sample bookings
                const bookings = [
                    {
                        companyName: 'EC Logistics',
                        clientCode: '1001',
                        distance: 25.5,
                        locationA: '123 Collection Street, B775JA, Birmingham',
                        locationB: '456 Delivery Avenue, M1 4AN, Manchester',
                        price: 255.00,
                        status: 'pending',
                        createdAt: new Date(),
                        updatedAt: new Date()
                    },
                    {
                        companyName: 'SOTO Transport',
                        clientCode: '1002',
                        distance: 18.3,
                        locationA: '789 Pickup Road, LS1 4DY, Leeds',
                        locationB: '321 Dropoff Street, B797RU, Tamworth',
                        price: 196.40,
                        status: 'confirmed',
                        createdAt: new Date(),
                        updatedAt: new Date()
                    }
                ];
                
                for (const booking of bookings) {
                    await addDoc(collection(db, 'bookings'), booking);
                }
                
                displayResult('‚úÖ Bookings schema created successfully!', 'success');
                displayResult(`Created ${bookings.length} sample bookings`, 'info');
                
            } catch (error) {
                displayResult(`‚ùå Error creating bookings schema: ${error.message}`, 'error');
            }
        }
        
        // Create Test Schema
        async function createTestSchema() {
            try {
                displayResult('Creating test schema...', 'info');
                
                // Create sample test messages
                const testMessages = [
                    {
                        messageText: 'Hello from Firebase! This is a test message.',
                        timestamp: new Date(),
                        messageId: 'test_msg_001',
                        createdAt: new Date().toISOString(),
                        testType: 'connection_test',
                        status: 'success'
                    },
                    {
                        messageText: 'Testing database write operations...',
                        timestamp: new Date(),
                        messageId: 'test_msg_002',
                        createdAt: new Date().toISOString(),
                        testType: 'write_test',
                        status: 'success'
                    },
                    {
                        messageText: 'Testing database read operations...',
                        timestamp: new Date(),
                        messageId: 'test_msg_003',
                        createdAt: new Date().toISOString(),
                        testType: 'read_test',
                        status: 'success'
                    },
                    {
                        messageText: 'SOTO Routes Firebase integration working perfectly!',
                        timestamp: new Date(),
                        messageId: 'test_msg_004',
                        createdAt: new Date().toISOString(),
                        testType: 'integration_test',
                        status: 'success'
                    }
                ];
                
                for (const message of testMessages) {
                    await addDoc(collection(db, 'testMessages'), message);
                }
                
                displayResult('‚úÖ Test schema created successfully!', 'success');
                displayResult(`Created ${testMessages.length} sample test messages`, 'info');
                displayResult('You can now test the test page at /pages/test.html', 'info');
                
            } catch (error) {
                displayResult(`‚ùå Error creating test schema: ${error.message}`, 'error');
            }
        }
        
        // Create Drivers Schema
        async function createDriversSchema() {
            try {
                displayResult('Creating drivers and driver availability schema...', 'info');
                
                // Create sample drivers
                const drivers = [
                    {
                        driverId: 'driver_001',
                        firstName: 'John',
                        lastName: 'Smith',
                        homePostcode: 'B775JA',
                        carryover: 1,
                        carryoverPostcode: 'M1 4AN',
                        phoneNumber: '+44 7700 900001',
                        email: 'john.smith@soto.com',
                        licenseNumber: 'DL123456789',
                        vehicleType: 'Van',
                        maxCapacity: 1000,
                        isActive: true,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    },
                    {
                        driverId: 'driver_002',
                        firstName: 'Sarah',
                        lastName: 'Johnson',
                        homePostcode: 'M1 4AN',
                        carryover: 0,
                        carryoverPostcode: '',
                        phoneNumber: '+44 7700 900002',
                        email: 'sarah.johnson@soto.com',
                        licenseNumber: 'DL987654321',
                        vehicleType: 'Truck',
                        maxCapacity: 2000,
                        isActive: true,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    },
                    {
                        driverId: 'driver_003',
                        firstName: 'Mike',
                        lastName: 'Wilson',
                        homePostcode: 'LS1 4DY',
                        carryover: 1,
                        carryoverPostcode: 'B797RU',
                        phoneNumber: '+44 7700 900003',
                        email: 'mike.wilson@soto.com',
                        licenseNumber: 'DL456789123',
                        vehicleType: 'Van',
                        maxCapacity: 1500,
                        isActive: true,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    },
                    {
                        driverId: 'driver_004',
                        firstName: 'Emma',
                        lastName: 'Brown',
                        homePostcode: 'B797RU',
                        carryover: 0,
                        carryoverPostcode: '',
                        phoneNumber: '+44 7700 900004',
                        email: 'emma.brown@soto.com',
                        licenseNumber: 'DL789123456',
                        vehicleType: 'Van',
                        maxCapacity: 1200,
                        isActive: false,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    },
                    {
                        driverId: 'driver_005',
                        firstName: 'David',
                        lastName: 'Taylor',
                        homePostcode: 'SW1A 0AA',
                        carryover: 1,
                        carryoverPostcode: 'LS1 4DY',
                        phoneNumber: '+44 7700 900005',
                        email: 'david.taylor@soto.com',
                        licenseNumber: 'DL321654987',
                        vehicleType: 'Truck',
                        maxCapacity: 2500,
                        isActive: true,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    }
                ];
                
                for (const driver of drivers) {
                    await addDoc(collection(db, 'drivers'), driver);
                }
                
                displayResult('‚úÖ Drivers schema created successfully!', 'success');
                displayResult(`Created ${drivers.length} sample drivers`, 'info');
                
                // Create driver availability records
                const availabilityRecords = [
                    {
                        driverId: 'driver_001',
                        date: new Date(),
                        isAvailable: true,
                        startTime: '08:00',
                        endTime: '17:00',
                        maxJobs: 5,
                        notes: 'Available for standard routes',
                        createdAt: new Date()
                    },
                    {
                        driverId: 'driver_002',
                        date: new Date(),
                        isAvailable: true,
                        startTime: '09:00',
                        endTime: '18:00',
                        maxJobs: 3,
                        notes: 'Heavy vehicle - large jobs only',
                        createdAt: new Date()
                    },
                    {
                        driverId: 'driver_003',
                        date: new Date(),
                        isAvailable: false,
                        startTime: '',
                        endTime: '',
                        maxJobs: 0,
                        notes: 'On holiday',
                        createdAt: new Date()
                    },
                    {
                        driverId: 'driver_004',
                        date: new Date(),
                        isAvailable: false,
                        startTime: '',
                        endTime: '',
                        maxJobs: 0,
                        notes: 'Inactive driver',
                        createdAt: new Date()
                    },
                    {
                        driverId: 'driver_005',
                        date: new Date(),
                        isAvailable: true,
                        startTime: '07:00',
                        endTime: '19:00',
                        maxJobs: 4,
                        notes: 'Early start available',
                        createdAt: new Date()
                    }
                ];
                
                for (const availability of availabilityRecords) {
                    await addDoc(collection(db, 'driverAvailability'), availability);
                }
                
                displayResult('‚úÖ Driver availability schema created successfully!', 'success');
                displayResult(`Created ${availabilityRecords.length} availability records`, 'info');
                
            } catch (error) {
                displayResult(`‚ùå Error creating drivers schema: ${error.message}`, 'error');
            }
        }
        
        // Create All Schemas
        async function createAllSchemas() {
            clearResults();
            displayResult('üöÄ Creating complete SOTO Routes database schema...', 'info');
            
            await createClientSchema();
            await createRoutesSchema();
            await createBookingsSchema();
            await createTestSchema();
            await createDriversSchema();
            
            displayResult('üéâ Complete database schema created successfully!', 'success');
            displayResult('Your SOTO Routes database is now ready to use!', 'info');
        }
        
        // View All Collections
        async function viewAllCollections() {
            try {
                displayResult('Fetching all collections...', 'info');
                
                // Note: Firestore doesn't have a direct way to list collections from client-side
                // We'll check the collections we know about
                const collections = ['clients', 'routes', 'jobs', 'bookings', 'testMessages', 'drivers', 'driverAvailability'];
                const results = {};
                
                for (const collectionName of collections) {
                    try {
                        const snapshot = await getDocs(query(collection(db, collectionName), limit(1)));
                        results[collectionName] = snapshot.docs.length > 0 ? 'Has data' : 'Empty';
                    } catch (error) {
                        results[collectionName] = 'Error';
                    }
                }
                
                displayResult('üìä Collection Status:', 'info');
                for (const [name, status] of Object.entries(results)) {
                    displayResult(`  ${name}: ${status}`, 'info');
                }
                
            } catch (error) {
                displayResult(`‚ùå Error viewing collections: ${error.message}`, 'error');
            }
        }
        
        // View specific collections
        async function viewClients() {
            try {
                const snapshot = await getDocs(collection(db, 'clients'));
                displayResult(`üìã Clients (${snapshot.docs.length} found):`, 'info');
                
                snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    displayResult(`  ${data.clientCode}: ${data.companyName} (${data.pricingFormula})`, 'info');
                });
                
            } catch (error) {
                displayResult(`‚ùå Error viewing clients: ${error.message}`, 'error');
            }
        }
        
        async function viewRoutes() {
            try {
                const snapshot = await getDocs(collection(db, 'routes'));
                displayResult(`üõ£Ô∏è Routes (${snapshot.docs.length} found):`, 'info');
                
                snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    displayResult(`  ${data.routeName} - ${data.driverName} (${data.totalJobs} jobs)`, 'info');
                });
                
            } catch (error) {
                displayResult(`‚ùå Error viewing routes: ${error.message}`, 'error');
            }
        }
        
        async function viewBookings() {
            try {
                const snapshot = await getDocs(collection(db, 'bookings'));
                displayResult(`üì¶ Bookings (${snapshot.docs.length} found):`, 'info');
                
                snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    displayResult(`  ${data.companyName}: ¬£${data.price} (${data.status})`, 'info');
                });
                
            } catch (error) {
                displayResult(`‚ùå Error viewing bookings: ${error.message}`, 'error');
            }
        }
        
        async function viewTestMessages() {
            try {
                const snapshot = await getDocs(query(collection(db, 'testMessages'), orderBy('timestamp', 'desc')));
                displayResult(`üß™ Test Messages (${snapshot.docs.length} found):`, 'info');
                
                snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    const time = data.timestamp.toDate().toLocaleString();
                    displayResult(`  [${data.testType}] ${data.messageText} (${time})`, 'info');
                });
                
            } catch (error) {
                displayResult(`‚ùå Error viewing test messages: ${error.message}`, 'error');
            }
        }
        
        async function viewDrivers() {
            try {
                const snapshot = await getDocs(query(collection(db, 'drivers'), orderBy('firstName', 'asc')));
                displayResult(`üöó Drivers (${snapshot.docs.length} found):`, 'info');
                
                snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    const carryoverText = data.carryover ? `Carryover: ${data.carryoverPostcode}` : 'No carryover';
                    const status = data.isActive ? 'Active' : 'Inactive';
                    displayResult(`  ${data.firstName} ${data.lastName} (${data.homePostcode}) - ${data.vehicleType} - ${status} - ${carryoverText}`, 'info');
                });
                
            } catch (error) {
                displayResult(`‚ùå Error viewing drivers: ${error.message}`, 'error');
            }
        }
        
        async function viewDriverAvailability() {
            try {
                const snapshot = await getDocs(query(collection(db, 'driverAvailability'), orderBy('date', 'desc')));
                displayResult(`üìÖ Driver Availability (${snapshot.docs.length} found):`, 'info');
                
                snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    const date = data.date.toDate().toLocaleDateString();
                    const status = data.isAvailable ? 'Available' : 'Unavailable';
                    const timeRange = data.isAvailable ? `${data.startTime}-${data.endTime}` : 'N/A';
                    displayResult(`  ${data.driverId} - ${date} - ${status} - ${timeRange} (Max: ${data.maxJobs} jobs)`, 'info');
                });
                
            } catch (error) {
                displayResult(`‚ùå Error viewing driver availability: ${error.message}`, 'error');
            }
        }
        
        // Make functions globally available
        window.createClientSchema = createClientSchema;
        window.createRoutesSchema = createRoutesSchema;
        window.createJobsOnlySchema = createJobsOnlySchema;
        window.createBookingsSchema = createBookingsSchema;
        window.createTestSchema = createTestSchema;
        window.createDriversSchema = createDriversSchema;
        window.createAllSchemas = createAllSchemas;
        window.viewAllCollections = viewAllCollections;
        window.viewClients = viewClients;
        window.viewRoutes = viewRoutes;
        window.viewBookings = viewBookings;
        window.viewTestMessages = viewTestMessages;
        window.viewDrivers = viewDrivers;
        window.viewDriverAvailability = viewDriverAvailability;
    </script>
</body>
</html>
